<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<style>
    *{
        margin: 0;
        padding: 0;
    }

    #game{
        width: 340px;
        height: 400px;
        border: 10px solid black;
        border-radius: 10%;
    /*    å±…ä¸­*/
        margin: 100px auto;
        background-color: #b7d4a8;
    /*    å¼€å¯å¼¹æ€§ç›’å­*/
        display: flex;
    /*    è®¾ç½®ä¸»è½´æ–¹å‘*/
        flex-flow: column;
    /*    è®¾ç½®ä¾§è½´å¯¹è±¡æ–¹å¼*/
        align-items: center;
    /*    è®¾ç½®æ ªæ´²å¯¹å…¶æ–¹å¼*/
        justify-content: space-around;
    }

    #stage{
        width: 304px;
        height: 300px;
        border: 2px solid black;
    /*    å¼€å¯å®šä½ï¼Œå› ä¸ºè›‡è¦ç§»åŠ¨*/
        position: relative;
    }

    #snake>div{
        box-sizing: border-box;
        width: 10px;
        height: 10px;
        background-color: #000;
        position: absolute;
        border: 1px solid #b7d4a8;
        border-radius: 50%;
    }

    #food{
        width: 10px;
        height: 10px;
        position: absolute;
        left: 80px;
        top: 100px;
    }

    /*äº‹ç‰©é€ å‹*/
    #food>div{
        width: 50%;
        height: 50%;
        background: #000;
        float: left;
        border-radius: 2px;
    /*    è®©4ä¸ªdivæ—‹è½¬*/
        transform: rotate(45deg);
    }

    #score-level{
        width: 304px;
    /*    è®¾ç½®å­—ä½“*/
        font: bold 20px "Courier";
    /*    è®¾ç½®å¼¹æ€§ç›’*/
        display: flex;
        justify-content: space-around;
    }

</style>
<body>
<div id="game">
<!--    æ¸¸æˆåŒºåŸŸ-->
    <div id="stage">
<!--        è›‡-->
        <div id="snake">
            <div>

            </div>
        </div>
<!--        é£Ÿç‰©-->
        <div id="food">
<!--            ç”¨äºè®¾è®¡äº‹ç‰©å½¢çŠ¶-->
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
<!--    ç§¯åˆ†åŒºåŸŸ-->
    <div id="score-level">
<!--        åˆ†æ•°-->
        <div id="score">
            score:<span>0</span>
        </div>
<!--        ç­‰çº§-->
        <div id="level">
            level:<span>1</span>
        </div>
    </div>
</div>

<script>
    /*
        1.éšæœºç”Ÿæˆäº‹ç‰©çš„ä½ç½®ï¼ˆåç§»é‡ï¼‰
        2.ä½¿è›‡ç§»åŠ¨
        3.æ£€æŸ¥æ˜¯å¦è¿Ÿåˆ°äº‹ç‰©
        4.åƒåˆ°åè›‡å˜é•¿ï¼Œè›‡çš„èº«ä½“å¦‚ä½•ç§»åŠ¨
        5.åˆ¤å®šæ¸¸æˆå¤±è´¥
        6.å¦‚ä½•é¿å…è›‡è°ƒå¤´
     */

    (function () {
        //éšæœºç”Ÿæˆäº‹ç‰©ä½ç½®
        //è·å–äº‹ç‰©
        let food = document.getElementById("food");
        // è·å–è›‡çš„å®¹å™¨
        let snake = document.getElementById('snake');
        // è·å–è›‡æ‰€æœ‰çš„èº«ä½“
        let snakeBody = snake.getElementsByTagName('div');
        // å­˜å‚¨è›‡ç§»åŠ¨æ–¹å‘
        let dir = null;
        // åˆ›å»ºæœ‰æ•ˆæŒ‰é”®æ•°ç»„
        let keyArr = ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'];
        // åˆ›å»ºå˜é‡æ ‡è¯†åˆ†æ•°å’Œç­‰çº§
        let score = 0, level = 1;
        // è·å–åˆ†æ•°ç­‰çº§å…ƒç´ 
        let scoreSpan = document.getElementById('score');
        let levelSpan = document.getElementById('level');
        function makeFood() {
            // å…¶å®å°±æ˜¯æ”¹å˜äº‹ç‰©çš„ä½ç½®
            // éšæœºç”Ÿæˆäº‹ç‰©ä½ç½®
            let foodLeft = Math.round(Math.random()*29)*10;
            let foodTop = Math.round(Math.random()*29)*10;
            food.style.left = foodLeft + 'px';
            food.style.top = foodTop + 'px';
        }

        // è·å–æ–¹å‘çš„äº‹ä»¶
        document.addEventListener('keydown', function (event) {
            // è¦åˆ¤æ–­æ˜¯æŒ‰çš„é‚£ä¸ªæŒ‰é”®ï¼Œä½¿ç”¨ä¸Šä¸‹å·¦å³æ‰æ”¹
            // ä¸ä½¿ç”¨inï¼Œå› ä¸ºinæ˜¯æŸ¥çœ‹æŸäº‹å¯¹è±¡æ˜¯å¦æœ‰æŸä¸ªå±æ€§ï¼Œå±æ€§åœ¨æ•°ç»„ä¸­å¯¹åº”çš„æ˜¯åˆ—è¡¨
            if(keyArr.indexOf(event.key) !== -1){
                dir = event.key;
            }
        })

        // è®¾ç½®è›‡çš„ç§»åŠ¨
        // å¼€å¯å®šæ—¶å™¨æ§åˆ¶è›‡çš„ç§»åŠ¨
        setTimeout(function main() {

            // å®šä¹‰ä¸¤ä¸ªå˜é‡ï¼Œæ¥è®°å½•èˆŒå¤´çš„æ–°ä½ç½®
            let snakeLeft = snakeBody[0].offsetLeft;
            let snakeTop = snakeBody[0].offsetTop;

            // æ§åˆ¶è›‡ç§»åŠ¨
            switch (dir) {
                case 'ArrowUp':
                    // åªè®¡ç®—ï¼Œä¸èµ‹å€¼
                    // åœ¨è®¡ç®—æ–°ä½ç½®æ—¶ï¼Œåˆ¤æ–­ä¼¼ä¹å¦æ˜¯æ‰å¤´ï¼Œä¸å…è®¸æ‰å¤´
                    snakeTop -= 10;
                    // å³æ£€æŸ¥æ–°çš„topå€¼ä¸ç¬¬äºŒæˆªtopå€¼æ˜¯å¦ç›¸åŒ
                    if(snakeBody.length > 1 && snakeTop === snakeBody[1].offsetTop){
                        // å‘ç”Ÿæ‰å¤´ï¼Œæˆ‘ä»¬è¦ä¿æŒè¿åŠ¨æ–¹å‘ä¸å˜ï¼Œå³åŸæœ¬-10ï¼Œæ”¹ä¸º+20
                        snakeTop += 20;
                    }
                    break;
                case 'ArrowDown':
                    snakeTop += 10;
                    if(snakeBody.length > 1 && snakeTop === snakeBody[1].offsetTop){
                        snakeTop -= 20;
                    }
                    break;
                case 'ArrowLeft':
                    snakeLeft -= 10;
                    if(snakeBody.length > 1 && snakeLeft === snakeBody[1].offsetLeft){
                        snakeLeft += 20;
                    }
                    break;
                case 'ArrowRight':
                    snakeLeft += 10;
                    if(snakeBody.length > 1 && snakeLeft === snakeBody[1].offsetLeft){
                        snakeLeft -= 20;
                    }
                    break;
            }

            // æ£€æŸ¥è›‡æ˜¯å¦æ’å¢™
            if(snakeLeft < 0 || snakeLeft > 290 || snakeTop < 0 || snakeTop > 290){
                alert("æ’å¢™å•¦ï¼ï¼ï¼ğŸ˜¢ğŸ˜¢")
                // å¦‚æœæ’å¢™ï¼Œå°†ä¸»å‡½æ•°return
                return;
            }

            // åœ¨ä¿®æ”¹è›‡å¤´ä½ç½®ä¹‹å‰ï¼Œæ£€æŸ¥ğŸæ˜¯å¦åƒåˆ°äº‹ç‰©
            if(snakeLeft === food.offsetLeft && snakeTop === food.offsetTop){
                // åƒåˆ°äº‹ç‰©
                // äº§ç”Ÿæ–°çš„äº‹ç‰©

                makeFood();
                // ğŸçš„èº«ä½“åŠ é•¿
                // åˆ›å»ºä¸€ä¸ªæ–°çš„div
                let newBody = document.createElement('div');
                // æ–°çš„èº«ä½“å¯ä»¥åŠ åœ¨å‰é¢ï¼Œä¹Ÿå¯ä»¥åŠ åœ¨åé¢
                snake.appendChild(newBody);
                score++;
                scoreSpan.innerHTML = String(score);
                // åˆ¤æ–­ç­‰çº§
                if(level < 10){
                    level = Math.floor(score / 5 + 1);
                    levelSpan.innerHTML = String(level);
                }
            }

            // ä¿®æ”¹è›‡èº«çš„çš„ä½ç½®
            /*
                ä¿®æ”¹è›‡èº«ä½ç½®åœ¨èˆŒå¤´ä¹‹å‰ï¼Œå› ä¸ºå¦‚æœå…ˆç§»åŠ¨èˆŒå¤´çš„ä½ç½®
                ç¬¬äºŒæ®µèº«ä½“ä¸€æŠ–èˆŒå¤´çš„ä½ç½®ï¼Œå¤´å’Œèº«ä½“åœ¨ä¸€èµ·ï¼Œæ°¸è¿œåªæœ‰ä¸¤ç«¯
                ï¼Œè€Œå…ˆç§»åŠ¨è›‡èº«å°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Œæœ¬è´¨å°±æ˜¯å…ˆç§»åŠ¨èˆŒå¤´æ—¶å°±æ‰¾ä¸åˆ°èº«ä½“æœ¬æ¥çš„ä½ç½®äº†
             */
            // åœ¨ä¿®æ”¹èº«ä½“ä½ç½®æ—¶æ£€æŸ¥æ˜¯å¦æ’åˆ°èº«ä½“
            for(let i = snakeBody.length - 1; i > 0; --i){
                let bodyLeft = snakeBody[i - 1].offsetLeft;
                let bodyTop = snakeBody[i - 1].offsetTop;
                // æ£€æŸ¥å¤´å’Œèº«ä½“æ˜¯å¦ç›¸æ’
                if(bodyLeft === snakeLeft && bodyTop === snakeTop){
                    alert("æ’åˆ°è‡ªå·±å•¦ï¼ï¼ğŸ˜¢ğŸ˜¢");
                    return;
                }
                // snakeBody[i].style.left = snakeBody[i - 1].offsetLeft + 'px';
                // snakeBody[i].style.top = snakeBody[i - 1].offsetTop + 'px';
                snakeBody[i].style.left = bodyLeft + 'px';
                snakeBody[i].style.top = bodyTop + 'px';
            }

            // ä¿®æ”¹è›‡å¤´çš„ä½ç½®
            snakeBody[0].style.left = snakeLeft + 'px';
            snakeBody[0].style.top = snakeTop + 'px';

            setTimeout(main, 300 - (30 * (level - 1)));
            }, 300);
    }())
</script>
</body>
</html>